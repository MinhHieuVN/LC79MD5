<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>TX API TABLE PRO</title>

<style>
body{
background:#0b0b1f;
font-family:Arial;
color:#00ffff;
text-align:center;
}

.container{
width:98%;
max-width:1000px;
margin:auto;
padding:20px;
}

table{
width:100%;
border-collapse:collapse;
margin-top:15px;
}

th,td{
padding:8px;
border:1px solid #00ffff;
font-size:14px;
}

th{
background:#001f2f;
cursor:pointer;
}

tr:nth-child(even){
background:#000814;
}

input{
padding:8px;
margin:5px;
border-radius:8px;
border:none;
}

button{
padding:8px 15px;
margin:5px;
border:none;
border-radius:8px;
background:linear-gradient(45deg,#00ffff,#ff00ff);
font-weight:bold;
}
</style>
</head>

<body>

<div class="container">

<h2>ðŸ“Š TX API TABLE PRO</h2>

<input type="text" id="search" placeholder="TÃ¬m kiáº¿m..." onkeyup="filterTable()">
<br>

<button onclick="loadData()">Láº¥y Dá»¯ Liá»‡u</button>
<button onclick="exportCSV()">Xuáº¥t CSV</button>
<button onclick="exportJSON()">Xuáº¥t JSON</button>
<button onclick="toggleAuto()">Auto 5s</button>

<div id="status"></div>

<table id="txTable">
<thead>
<tr>
<th onclick="sortTable(0)">PhiÃªn</th>
<th onclick="sortTable(1)">MD5</th>
<th onclick="sortTable(2)">XÃºc Xáº¯c</th>
<th onclick="sortTable(3)">Tá»•ng</th>
<th onclick="sortTable(4)">KQ</th>
</tr>
</thead>
<tbody></tbody>
</table>

</div>

<script>

let auto=false;
let interval;
let globalData=[];

const proxies=[
"https://corsproxy.io/?",
"https://api.allorigins.win/raw?url="
];

const api="https://wtxmd52.tele68.com/v1/txmd5/sessions";

async function fetchWithProxy(){
for(let proxy of proxies){
try{
let res=await fetch(proxy+api);
if(res.ok){
document.getElementById("status").innerHTML="âœ… Káº¿t ná»‘i thÃ nh cÃ´ng";
return await res.json();
}
}catch(e){}
}
document.getElementById("status").innerHTML="âŒ KhÃ´ng láº¥y Ä‘Æ°á»£c API";
return [];
}

async function loadData(){
let data=await fetchWithProxy();
if(!data.length) return;

globalData=data.slice(0,100);
renderTable(globalData);
}

function renderTable(data){
let tbody=document.querySelector("#txTable tbody");
tbody.innerHTML="";

data.forEach(item=>{
let row=`
<tr>
<td>${item.id}</td>
<td>${item._id}</td>
<td>${item.dices.join("-")}</td>
<td>${item.point}</td>
<td>${item.resultTruyenThong}</td>
</tr>
`;
tbody.innerHTML+=row;
});
}

function filterTable(){
let keyword=document.getElementById("search").value.toLowerCase();
let filtered=globalData.filter(item=>
item.id.toString().includes(keyword) ||
item._id.includes(keyword) ||
item.resultTruyenThong.toLowerCase().includes(keyword)
);
renderTable(filtered);
}

function sortTable(n){
let rows=[...document.querySelectorAll("#txTable tbody tr")];
rows.sort((a,b)=>{
return a.cells[n].innerText.localeCompare(b.cells[n].innerText,undefined,{numeric:true});
});
let tbody=document.querySelector("#txTable tbody");
tbody.innerHTML="";
rows.forEach(r=>tbody.appendChild(r));
}

function exportCSV(){
let csv="PhiÃªn,MD5,XucXac,Tong,KQ\n";
globalData.forEach(item=>{
csv+=`${item.id},${item._id},${item.dices.join("-")},${item.point},${item.resultTruyenThong}\n`;
});
downloadFile(csv,"tx-data.csv","text/csv");
}

function exportJSON(){
let json=JSON.stringify(globalData,null,2);
downloadFile(json,"tx-data.json","application/json");
}

function downloadFile(content,filename,type){
let blob=new Blob([content],{type});
let a=document.createElement("a");
a.href=URL.createObjectURL(blob);
a.download=filename;
a.click();
}

function toggleAuto(){
auto=!auto;
if(auto){
interval=setInterval(loadData,5000);
}else{
clearInterval(interval);
}
}

</script>

</body>
</html>
